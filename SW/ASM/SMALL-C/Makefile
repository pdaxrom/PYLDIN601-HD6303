VM = ./scvm

all: scvm SMALLCX.CMD AS03X.CMD SMALLC.CMD AS03.CMD

CFLAGS = -O2

scvm: scvm.o
	$(CC) -o $@ $^

SMALLCX.CMD: scvm NATIVE/SMALLCX.C
	$(VM) BOOTSTRAP/SMALLC.CMD -o SMALLCX.ASM NATIVE/SMALLCX.C
	$(VM) BOOTSTRAP/AS03.CMD -o SMALLCX.CMD SMALLCX.ASM

AS03X.CMD: scvm AS03/AS03.C
	cd AS03 && ../$(VM) ../BOOTSTRAP/SMALLC.CMD -o ../AS03X.ASM AS03.C
	$(VM) BOOTSTRAP/AS03.CMD -o AS03X.CMD AS03X.ASM

SMALLC.CMD: scvm NATIVE/SMALLCX.C
	$(VM) SMALLCX.CMD -o SMALLC.ASM NATIVE/SMALLCX.C
	$(VM) AS03X.CMD -o SMALLC.CMD SMALLC.ASM

AS03.CMD: scvm AS03/AS03.C
	cd AS03 && ../$(VM) ../SMALLC.CMD -o ../AS03.ASM AS03.C
	$(VM) AS03X.CMD -o AS03.CMD AS03.ASM


clean:
	rm -f scvm *.o out.sym AS03X.CMD AS03X.ASM SMALLCX.CMD SMALLCX.ASM AS03.CMD AS03.ASM SMALLC.CMD SMALLC.ASM
